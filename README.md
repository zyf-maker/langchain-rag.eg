# 民法万事通 - RAG知识库问答系统

## 项目简介

这是一个基于检索增强生成（RAG）技术的智能问答系统，专为法律领域设计。系统支持上传PDF法律文档，自动构建知识库，并能根据文档内容回答用户问题。当知识库中没有相关信息时，系统会自动切换到通用问答模式。

## 核心功能

- 📄 **多PDF文件支持**：上传多个PDF文件构建综合知识库
- 🔍 **智能检索**：基于向量相似度和关键词的混合检索策略
- 📊 **知识图谱增强**：集成Neo4j知识图谱，提升检索准确性和语义理解
- 🧠 **高级检索策略**：实现向量:关键词=6:4的粗排，结合知识图谱匹配进行精排
- 💬 **上下文感知回答**：根据检索到的相关内容生成准确回答
- 📝 **聊天历史记录**：保存并显示用户的问答历史
- ⚙️ **高级配置选项**：支持自定义检索数量、生成温度等参数
- 🔧 **知识库管理**：支持测试、清除等知识库管理功能
- 📊 **文件处理状态跟踪**：显示处理进度和结果统计

## 技术栈

- **Python 3.8+**：核心编程语言
- **Streamlit**：交互式Web界面
- **LangChain**：RAG框架和工具集
- **Chroma DB**：向量数据库
- **Neo4j**：图数据库，用于知识图谱构建和语义关系检索
- **PyPDF2**：PDF文件处理
- **火山引擎**：文本嵌入模型
- **DeepSeek**：大语言模型

## 目录结构

```
RAG/
├── demo91_ask_for_pdf_2.py  # 主程序入口
├── config.py               # 配置管理模块
├── requirements.txt        # 项目依赖
├── .env                    # 环境变量配置（需自行创建）
├── utils/                  # 工具模块
│   ├── pdf_utils.py        # PDF处理工具
│   ├── vector_utils.py     # 向量数据库工具
│   ├── llm_utils.py        # 语言模型工具
│   └── error_handling.py   # 错误处理模块
└── chroma_db/              # 向量数据库存储（自动生成）
```

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置环境变量

复制或创建`.env`文件，并填入以下配置：

```env
# 火山引擎API配置
VOLC_API_KEY=your_volc_api_key
EMBEDDING_MODEL=doubao-embedding-text-240715

# DeepSeek API配置
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_API_URL=https://api.deepseek.com/v1
LLM_MODEL=deepseek-chat

# 向量数据库配置
CHROMA_DB_PATH=./chroma_db

# Neo4j知识图谱配置
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password

# 文本分割配置
CHUNK_SIZE=500
CHUNK_OVERLAP=50

# 生成配置
TEMPERATURE=0.1

# 应用配置
APP_NAME=民法万事通
APP_ICON=📚
APP_DESCRIPTION=基于文档的智能问答系统，专注于法律领域知识问答
```

### 3. 运行程序

```bash
streamlit run demo91_ask_for_pdf_2.py
```

## 使用说明

1. **上传文档**：在主界面上传一个或多个PDF法律文档
2. **等待处理**：系统会自动提取文本、分割、创建嵌入向量并存储到知识库
3. **提出问题**：在问题输入框中输入您想了解的法律问题
4. **查看答案**：系统会基于文档内容生成准确的回答
5. **高级选项**：可通过高级选项调整搜索结果数量和生成温度
6. **管理知识库**：可在侧边栏测试或清除当前知识库

## 故障排除

### API密钥问题
- 确保`.env`文件中的API密钥正确无误
- 检查网络连接是否正常

### Neo4j连接问题
- 确保Neo4j服务正在运行
- 检查`.env`中的Neo4j连接参数是否正确
- 确保Neo4j数据库版本兼容（推荐Neo4j 4.x或5.x）

### 知识图谱构建问题
- 如果知识图谱构建失败，请检查Neo4j用户权限
- 确认系统有足够的内存处理大型文档的实体提取和关系构建
- 验证API密钥是否在有效期内

### PDF处理问题
- 确保上传的PDF文件非加密、可提取文本
- 对于扫描件PDF，可能需要OCR预处理
- 对于特别大的文件，可能需要更长的处理时间

### 知识库检索问题
- 尝试调整高级选项中的搜索结果数量
- 检查问题描述是否清晰、具体
- 确保知识库中包含与问题相关的内容

## 注意事项

- 所有API密钥存储在本地环境变量中，不会上传到任何服务器
- 向量数据库存储在本地，建议定期备份重要数据
- 处理大文件时，可能需要更多内存和处理时间
- 系统性能取决于API调用速度和网络状况

## 许可证

本项目仅供学习和参考使用。

## 更新日志

### v1.0.0
- 初始版本发布
- 支持多PDF文件上传
- 基于RAG的智能问答
- 聊天历史记录功能
- 知识库管理工具